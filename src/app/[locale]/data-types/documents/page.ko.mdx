export const metadata = {
  title: '문서',
  description: 'CMS-Orbit의 문서(Documents)에 대해 알아봅니다.',
}

export const sections = [
  { title: '문서 생성하기', id: 'creating-documents' },
  { title: '문서의 특징', id: 'features' },
  { title: '문서 예제', id: 'examples' },
  { title: '문서의 사용 사례', id: 'use-cases' },
]

# 문서

CMS-Orbit에서 문서를 생성하고 관리하는 방법을 알아봅니다. {{ className: 'lead' }}

## 문서 생성하기

### cms:document 명령어 사용

```bash {{ title: '문서 생성 명령어' }}
php artisan cms:document Page
```

이 명령어는 다음 파일들을 생성합니다:
- `app/Documents/Page.php`
- `database/migrations/YYYY_MM_DD_create_pages_table.php`
- `app/Orchid/Resources/PageResource.php`

### 문서 클래스 구조

```php {{ title: '기본 문서 클래스' }}
namespace App\Documents;

use Orbit\Documents\Document;
use Orbit\Traits\AsSource;
use Orbit\Traits\Filterable;
use Orbit\Traits\Attachable;

class Page extends Document
{
    use AsSource, Filterable, Attachable;

    protected $fillable = [
        'title',
        'slug',
        'content',
        'status',
        'published_at'
    ];

    protected $casts = [
        'published_at' => 'datetime',
        'is_featured' => 'boolean'
    ];
}
```

### 마이그레이션 생성

```php {{ title: '기본 마이그레이션' }}
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('pages', function (Blueprint $table) {
            $table->id();
            $table->string('title');
            $table->string('slug')->unique();
            $table->text('content');
            $table->string('status')->default('draft');
            $table->timestamp('published_at')->nullable();
            $table->boolean('is_featured')->default(false);
            $table->json('meta')->nullable();
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('pages');
    }
};
```

## 문서의 특징

### 버전 관리

```php {{ title: '버전 관리' }}
class Page extends Document
{
    public function versions()
    {
        return $this->hasMany(PageVersion::class);
    }

    public function createVersion()
    {
        return $this->versions()->create([
            'title' => $this->title,
            'content' => $this->content,
            'meta' => $this->meta
        ]);
    }

    public function restoreVersion($versionId)
    {
        $version = $this->versions()->findOrFail($versionId);
        
        $this->update([
            'title' => $version->title,
            'content' => $version->content,
            'meta' => $version->meta
        ]);
        
        return $this;
    }
}
```

### 상태 관리

```php {{ title: '상태 관리' }}
class Page extends Document
{
    const STATUS_DRAFT = 'draft';
    const STATUS_PENDING = 'pending';
    const STATUS_PUBLISHED = 'published';
    const STATUS_ARCHIVED = 'archived';

    protected $fillable = [
        'status'
    ];

    public function publish()
    {
        $this->update([
            'status' => self::STATUS_PUBLISHED,
            'published_at' => now()
        ]);
    }

    public function archive()
    {
        $this->update([
            'status' => self::STATUS_ARCHIVED
        ]);
    }

    public function scopePublished($query)
    {
        return $query->where('status', self::STATUS_PUBLISHED);
    }
}
```

### 다국어 지원

```php {{ title: '다국어 지원' }}
class Page extends Document
{
    protected $fillable = [
        'locale',
        'title',
        'content'
    ];

    public function translations()
    {
        return $this->hasMany(PageTranslation::class);
    }

    public function getTranslation($locale)
    {
        return $this->translations()
            ->where('locale', $locale)
            ->first();
    }

    public function createTranslation($locale, array $attributes)
    {
        return $this->translations()->create(
            array_merge($attributes, ['locale' => $locale])
        );
    }
}
```

### SEO 최적화

```php {{ title: 'SEO 최적화' }}
class Page extends Document
{
    protected $fillable = [
        'meta_title',
        'meta_description',
        'meta_keywords',
        'canonical_url'
    ];

    public function getMetaTags()
    {
        return [
            'title' => $this->meta_title ?: $this->title,
            'description' => $this->meta_description,
            'keywords' => $this->meta_keywords,
            'canonical' => $this->canonical_url
        ];
    }

    public function generateSitemapEntry()
    {
        return [
            'url' => $this->getUrl(),
            'lastmod' => $this->updated_at,
            'changefreq' => 'weekly',
            'priority' => 0.8
        ];
    }
}
```

## 문서 예제

### 페이지 문서

```php {{ title: '페이지 문서' }}
namespace App\Documents;

use Orbit\Documents\Document;
use Orbit\Traits\AsSource;
use Orbit\Traits\Filterable;

class Page extends Document
{
    use AsSource, Filterable;

    protected $fillable = [
        'title',
        'slug',
        'content',
        'status',
        'parent_id',
        'order',
        'template'
    ];

    protected $casts = [
        'published_at' => 'datetime',
        'is_homepage' => 'boolean'
    ];

    public function parent()
    {
        return $this->belongsTo(Page::class, 'parent_id');
    }

    public function children()
    {
        return $this->hasMany(Page::class, 'parent_id');
    }

    public function getUrl()
    {
        if ($this->is_homepage) {
            return '/';
        }

        $slug = $this->slug;
        $parent = $this->parent;

        while ($parent) {
            $slug = $parent->slug . '/' . $slug;
            $parent = $parent->parent;
        }

        return '/' . $slug;
    }
}
```

### 블로그 포스트

```php {{ title: '블로그 포스트' }}
namespace App\Documents;

use Orbit\Documents\Document;
use Orbit\Traits\AsSource;
use Orbit\Traits\Filterable;

class Post extends Document
{
    use AsSource, Filterable;

    protected $fillable = [
        'title',
        'slug',
        'content',
        'excerpt',
        'status',
        'author_id',
        'category_id',
        'published_at'
    ];

    protected $casts = [
        'published_at' => 'datetime',
        'is_featured' => 'boolean'
    ];

    public function author()
    {
        return $this->belongsTo(User::class);
    }

    public function category()
    {
        return $this->belongsTo(Category::class);
    }

    public function tags()
    {
        return $this->belongsToMany(Tag::class);
    }

    public function comments()
    {
        return $this->hasMany(Comment::class);
    }

    public function getReadingTime()
    {
        $words = str_word_count(strip_tags($this->content));
        return ceil($words / 200); // 200 words per minute
    }
}
```

### 뉴스 기사

```php {{ title: '뉴스 기사' }}
namespace App\Documents;

use Orbit\Documents\Document;
use Orbit\Traits\AsSource;
use Orbit\Traits\Filterable;

class News extends Document
{
    use AsSource, Filterable;

    protected $fillable = [
        'title',
        'slug',
        'content',
        'summary',
        'status',
        'author_id',
        'source',
        'published_at',
        'expires_at'
    ];

    protected $casts = [
        'published_at' => 'datetime',
        'expires_at' => 'datetime',
        'is_breaking' => 'boolean'
    ];

    public function author()
    {
        return $this->belongsTo(User::class);
    }

    public function categories()
    {
        return $this->belongsToMany(Category::class);
    }

    public function isExpired()
    {
        return $this->expires_at && $this->expires_at->isPast();
    }

    public function getRelatedNews($limit = 5)
    {
        return static::whereHas('categories', function ($query) {
            $query->whereIn('id', $this->categories()->pluck('id'));
        })
        ->where('id', '!=', $this->id)
        ->where('status', 'published')
        ->where('expires_at', '>', now())
        ->orderBy('published_at', 'desc')
        ->limit($limit)
        ->get();
    }
}
```

## 문서의 사용 사례

### 정적 페이지

```php {{ title: '정적 페이지 관리' }}
class Page extends Document
{
    public static function getHomepage()
    {
        return static::where('is_homepage', true)->first();
    }

    public static function getBySlug($slug)
    {
        return static::where('slug', $slug)
            ->where('status', 'published')
            ->first();
    }

    public static function getNavigation()
    {
        return static::where('status', 'published')
            ->whereNull('parent_id')
            ->orderBy('order')
            ->get()
            ->map(function ($page) {
                return [
                    'title' => $page->title,
                    'url' => $page->getUrl(),
                    'children' => $page->children()
                        ->where('status', 'published')
                        ->orderBy('order')
                        ->get()
                        ->map(function ($child) {
                            return [
                                'title' => $child->title,
                                'url' => $child->getUrl()
                            ];
                        })
                ];
            });
    }
}
```

### 블로그 시스템

```php {{ title: '블로그 시스템' }}
class Post extends Document
{
    public static function getRecentPosts($limit = 5)
    {
        return static::where('status', 'published')
            ->orderBy('published_at', 'desc')
            ->limit($limit)
            ->get();
    }

    public static function getPopularPosts($limit = 5)
    {
        return static::where('status', 'published')
            ->orderBy('view_count', 'desc')
            ->limit($limit)
            ->get();
    }

    public static function getPostsByCategory($categoryId, $perPage = 10)
    {
        return static::where('status', 'published')
            ->where('category_id', $categoryId)
            ->orderBy('published_at', 'desc')
            ->paginate($perPage);
    }

    public static function getPostsByTag($tagId, $perPage = 10)
    {
        return static::where('status', 'published')
            ->whereHas('tags', function ($query) use ($tagId) {
                $query->where('id', $tagId);
            })
            ->orderBy('published_at', 'desc')
            ->paginate($perPage);
    }
}
```

### 뉴스 시스템

```php {{ title: '뉴스 시스템' }}
class News extends Document
{
    public static function getBreakingNews()
    {
        return static::where('status', 'published')
            ->where('is_breaking', true)
            ->where('expires_at', '>', now())
            ->orderBy('published_at', 'desc')
            ->get();
    }

    public static function getLatestNews($limit = 10)
    {
        return static::where('status', 'published')
            ->where('expires_at', '>', now())
            ->orderBy('published_at', 'desc')
            ->limit($limit)
            ->get();
    }

    public static function getNewsByCategory($categoryId, $perPage = 10)
    {
        return static::where('status', 'published')
            ->where('expires_at', '>', now())
            ->whereHas('categories', function ($query) use ($categoryId) {
                $query->where('id', $categoryId);
            })
            ->orderBy('published_at', 'desc')
            ->paginate($perPage);
    }

    public static function getArchivedNews($perPage = 10)
    {
        return static::where('status', 'published')
            ->where('expires_at', '<=', now())
            ->orderBy('published_at', 'desc')
            ->paginate($perPage);
    }
}
```

<div className="not-prose">
  <Button href="/multi-site/basics" variant="text" arrow="right">
    <>멀티사이트 알아보기</>
  </Button>
</div>

# 문서 데이터 타입

문서 데이터 타입은 문서의 구조와 유효성 검사 규칙을 정의합니다. 데이터 일관성을 보장하고 타입 안전성을 제공합니다.

## 주요 기능

- **타입 정의**: 문서의 구조 정의
- **유효성 검사 규칙**: 데이터 무결성 보장
- **기본값**: 필드의 기본값 설정
- **사용자 정의 타입**: 사용자 정의 데이터 타입 생성

## 예시

```typescript
// 문서 타입 정의 예시
interface DocumentType {
  id: string;
  name: string;
  fields: {
    title: {
      type: 'string';
      required: true;
      maxLength: 100;
    };
    content: {
      type: 'text';
      required: true;
    };
    tags: {
      type: 'array';
      items: {
        type: 'string';
      };
    };
  };
}
```

## 모범 사례

1. 의미 있는 타입 이름 사용
2. 적절한 유효성 검사 구현
3. 적절한 기본값 설정
4. 타입 정의 문서화 