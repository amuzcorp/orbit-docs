export const metadata = {
  title: '사이트 모범 사례',
  description: 'CMS-Orbit의 사이트 운영 모범 사례에 대해 알아봅니다.',
}

export const sections = [
  { title: '설계 모범 사례', id: 'design-practices' },
  { title: '개발 모범 사례', id: 'development-practices' },
  { title: '운영 모범 사례', id: 'operation-practices' },
]

# 사이트 모범 사례

CMS-Orbit을 사용하여 사이트를 설계, 개발, 운영할 때 따라야 할 모범 사례를 알아봅니다. {{ className: 'lead' }}

## 설계 모범 사례

### 아키텍처 설계

```php {{ title: '아키텍처 설계' }}
// config/tenancy.php
return [
    'architecture' => [
        // 모듈화된 구조
        'modules' => [
            'core' => [
                'enabled' => true,
                'priority' => 1,
            ],
            'auth' => [
                'enabled' => true,
                'priority' => 2,
            ],
            'content' => [
                'enabled' => true,
                'priority' => 3,
            ],
        ],
        // 마이크로서비스 구조
        'services' => [
            'api' => [
                'enabled' => true,
                'scalable' => true,
            ],
            'worker' => [
                'enabled' => true,
                'scalable' => true,
            ],
            'cache' => [
                'enabled' => true,
                'distributed' => true,
            ],
        ],
    ],
];
```

### 데이터베이스 설계

```php {{ title: '데이터베이스 설계' }}
// database/migrations/YYYY_MM_DD_create_tenants_table.php
Schema::create('tenants', function (Blueprint $table) {
    $table->id();
    $table->string('name');
    $table->string('domain')->unique();
    $table->json('settings')->nullable();
    $table->boolean('active')->default(true);
    $table->timestamps();
    $table->softDeletes();
});

// 인덱스 설계
$table->index(['domain', 'active']);
$table->index('created_at');
```

### 보안 설계

```php {{ title: '보안 설계' }}
// config/tenancy.php
return [
    'security' => [
        // 인증
        'auth' => [
            'driver' => 'session',
            'provider' => 'tenants',
            'guards' => ['web', 'api'],
        ],
        // 권한
        'permissions' => [
            'enabled' => true,
            'cache' => true,
        ],
        // 암호화
        'encryption' => [
            'enabled' => true,
            'key' => env('APP_KEY'),
        ],
    ],
];
```

## 개발 모범 사례

### 코드 구조

```php {{ title: '코드 구조' }}
// app/Tenants/SiteA/
├── Controllers/
│   ├── HomeController.php
│   └── AdminController.php
├── Models/
│   ├── Post.php
│   └── User.php
├── Services/
│   ├── ContentService.php
│   └── AuthService.php
└── Resources/
    ├── PostResource.php
    └── UserResource.php
```

### 테스트 작성

```php {{ title: '테스트 작성' }}
use Orbit\Tenancy\Tenant;
use Tests\TestCase;

class TenantTest extends TestCase
{
    public function test_tenant_creation()
    {
        $tenant = Tenant::create([
            'name' => 'Test Tenant',
            'domain' => 'test.example.com',
        ]);

        $this->assertNotNull($tenant);
        $this->assertEquals('test.example.com', $tenant->domain);
    }

    public function test_tenant_database()
    {
        $tenant = Tenant::find('test-tenant');

        $tenant->run(function () {
            $this->assertDatabaseHas('users', [
                'email' => 'admin@example.com',
            ]);
        });
    }
}
```

### 문서화

```php {{ title: '문서화' }}
/**
 * 테넌트 클래스
 *
 * @package App\Tenancy
 * @property int $id
 * @property string $name
 * @property string $domain
 * @property array $settings
 * @property bool $active
 * @property \Carbon\Carbon $created_at
 * @property \Carbon\Carbon $updated_at
 * @property \Carbon\Carbon $deleted_at
 */
class Tenant extends Model
{
    /**
     * 테넌트 초기화
     *
     * @return void
     * @throws \Exception
     */
    public function initialize()
    {
        // 초기화 로직
    }
}
```

## 운영 모범 사례

### 모니터링

```php {{ title: '모니터링' }}
// config/tenancy.php
return [
    'monitoring' => [
        // 성능 모니터링
        'performance' => [
            'enabled' => true,
            'interval' => 60,
            'metrics' => [
                'cpu',
                'memory',
                'disk',
                'network',
            ],
        ],
        // 오류 모니터링
        'errors' => [
            'enabled' => true,
            'level' => 'error',
            'notify' => true,
        ],
        // 사용자 모니터링
        'users' => [
            'enabled' => true,
            'track' => [
                'login',
                'actions',
                'errors',
            ],
        ],
    ],
];
```

### 백업

```php {{ title: '백업' }}
// config/tenancy.php
return [
    'backup' => [
        // 데이터베이스 백업
        'database' => [
            'enabled' => true,
            'schedule' => 'daily',
            'retention' => 7,
        ],
        // 파일 백업
        'files' => [
            'enabled' => true,
            'schedule' => 'weekly',
            'retention' => 30,
        ],
        // 설정 백업
        'settings' => [
            'enabled' => true,
            'schedule' => 'daily',
            'retention' => 7,
        ],
    ],
];
```

### 확장성

```php {{ title: '확장성' }}
// config/tenancy.php
return [
    'scaling' => [
        // 수평 확장
        'horizontal' => [
            'enabled' => true,
            'auto' => true,
            'min_servers' => 2,
            'max_servers' => 10,
        ],
        // 수직 확장
        'vertical' => [
            'enabled' => true,
            'auto' => true,
            'resources' => [
                'cpu',
                'memory',
                'storage',
            ],
        ],
        // 로드 밸런싱
        'load_balancing' => [
            'enabled' => true,
            'algorithm' => 'round_robin',
            'health_check' => true,
        ],
    ],
];
```

### 보안

```php {{ title: '보안' }}
// config/tenancy.php
return [
    'security' => [
        // 인증
        'authentication' => [
            'enabled' => true,
            'methods' => [
                'password',
                '2fa',
                'sso',
            ],
        ],
        // 권한
        'authorization' => [
            'enabled' => true,
            'roles' => true,
            'permissions' => true,
        ],
        // 암호화
        'encryption' => [
            'enabled' => true,
            'algorithms' => [
                'aes-256-cbc',
                'rsa-2048',
            ],
        ],
    ],
];
```

### 모범 사례 명령어

```bash {{ title: '모범 사례 명령어' }}
# 코드 품질 검사
php artisan tenancy:check site-a

# 보안 검사
php artisan tenancy:security site-a

# 성능 검사
php artisan tenancy:performance site-a

# 문서 생성
php artisan tenancy:docs site-a
```

<div className="not-prose">
  <Button href="/multi-site/examples" variant="text" arrow="right">
    <>사이트 예제 알아보기</>
  </Button>
</div> 