# Multi-Site Troubleshooting

This guide explains common issues and their solutions in a multi-site application.

## Common Issue Types

- **Connection Issues**: Database, cache, and file system connection errors
- **Performance Issues**: Slow response times, high resource usage
- **Synchronization Issues**: Data and configuration sync failures
- **Security Issues**: Authentication and permission errors

## Problem Diagnosis

### System Status Check

```php {{ title: 'System Status Check' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Check overall system status
$status = $tenant->diagnose()->checkSystem();

// Check specific component status
$dbStatus = $tenant->diagnose()->checkDatabase();
$cacheStatus = $tenant->diagnose()->checkCache();
$storageStatus = $tenant->diagnose()->checkStorage();
```

### Log Analysis

```php {{ title: 'Log Analysis' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Check error logs
$errors = $tenant->logs()->errors()->get();

// Check performance logs
$performance = $tenant->logs()->performance()->get();

// Check security logs
$security = $tenant->logs()->security()->get();
```

### Performance Analysis

```php {{ title: 'Performance Analysis' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Analyze response time
$responseTime = $tenant->analyze()->responseTime();

// Analyze resource usage
$resourceUsage = $tenant->analyze()->resourceUsage();

// Analyze database queries
$queryPerformance = $tenant->analyze()->queryPerformance();
```

## Common Problem Solutions

### Connection Issues

```php {{ title: 'Connection Issue Resolution' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Check database connection
$dbConnection = $tenant->diagnose()->checkDatabaseConnection();

if (!$dbConnection['connected']) {
    // Retry connection
    $tenant->database()->reconnect();
    
    // Verify connection settings
    $tenant->database()->verifyConfiguration();
}

// Check cache connection
$cacheConnection = $tenant->diagnose()->checkCacheConnection();

if (!$cacheConnection['connected']) {
    // Retry cache connection
    $tenant->cache()->reconnect();
    
    // Verify cache settings
    $tenant->cache()->verifyConfiguration();
}
```

### Performance Issues

```php {{ title: 'Performance Issue Resolution' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Optimize cache
$tenant->optimize()->cache([
    'clear_old' => true,
    'rebuild_indexes' => true,
]);

// Optimize database
$tenant->optimize()->database([
    'analyze_tables' => true,
    'optimize_tables' => true,
    'repair_tables' => true,
]);

// Optimize file system
$tenant->optimize()->storage([
    'cleanup_temp' => true,
    'optimize_storage' => true,
]);
```

### Synchronization Issues

```php {{ title: 'Synchronization Issue Resolution' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Check data synchronization
$syncStatus = $tenant->sync()->check();

if (!$syncStatus['synchronized']) {
    // Run data synchronization
    $tenant->sync()->run([
        'type' => 'full',
        'force' => true,
    ]);
}

// Check configuration synchronization
$configSync = $tenant->sync()->checkConfig();

if (!$configSync['synchronized']) {
    // Run configuration synchronization
    $tenant->sync()->runConfig([
        'force' => true,
    ]);
}
```

### Security Issues

```php {{ title: 'Security Issue Resolution' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Check security settings
$securityStatus = $tenant->security()->check();

if (!$securityStatus['secure']) {
    // Update security settings
    $tenant->security()->update([
        'ssl' => true,
        'firewall' => true,
        'permissions' => true,
    ]);
}

// Check permissions
$permissions = $tenant->security()->checkPermissions();

if (!$permissions['correct']) {
    // Reset permissions
    $tenant->security()->resetPermissions();
}
```

## Troubleshooting Commands

```bash {{ title: 'Troubleshooting Commands' }}
# Check system status
php artisan tenancy:diagnose site-a

# Check logs
php artisan tenancy:logs site-a --type=error

# Analyze performance
php artisan tenancy:analyze site-a

# Troubleshoot issues
php artisan tenancy:troubleshoot site-a --issue=connection
```

## Best Practices

1. Regular system status checks
2. Log monitoring and analysis
3. Performance metric tracking
4. Regular security audits
5. Document troubleshooting steps

<div className="not-prose">
  <Button href="/multi-site/maintenance" variant="text" arrow="right">
    <>Learn about Site Maintenance</>
  </Button>
</div> 