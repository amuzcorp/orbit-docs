export const metadata = {
  title: '멀티사이트 기본',
  description: 'CMS-Orbit의 멀티사이트 기능에 대해 알아봅니다.',
}

export const sections = [
  { title: '멀티사이트 개념', id: 'concepts' },
  { title: '사이트 구조', id: 'structure' },
]

# 멀티사이트 기본

CMS-Orbit의 멀티사이트 기능을 이해하고 활용하는 방법을 알아봅니다. {{ className: 'lead' }}

## 멀티사이트 개념

### 사이트 격리

멀티사이트 기능의 핵심은 각 사이트의 데이터와 리소스를 격리하는 것입니다:

- **데이터베이스 격리**: 각 사이트는 독립적인 데이터베이스를 가집니다.
- **파일 시스템 격리**: 각 사이트는 독립적인 파일 저장소를 가집니다.
- **세션 격리**: 각 사이트는 독립적인 세션을 가집니다.

### 데이터 분리

각 사이트의 데이터는 완전히 분리되어 관리됩니다:

```php {{ title: '데이터 분리 예제' }}
// 사이트 A의 데이터
$siteA = Tenant::find('site-a');
$siteA->run(function () {
    $posts = Post::all(); // 사이트 A의 게시물
});

// 사이트 B의 데이터
$siteB = Tenant::find('site-b');
$siteB->run(function () {
    $posts = Post::all(); // 사이트 B의 게시물
});
```

### 리소스 공유

일부 리소스는 여러 사이트 간에 공유될 수 있습니다:

- **테마**: 모든 사이트에서 동일한 테마를 사용할 수 있습니다.
- **플러그인**: 모든 사이트에서 동일한 플러그인을 사용할 수 있습니다.
- **설정**: 일부 설정은 모든 사이트에 적용될 수 있습니다.

## 사이트 구조

### 도메인 구조

각 사이트는 고유한 도메인을 가집니다:

```php {{ title: '도메인 설정' }}
// config/tenancy.php
return [
    'tenant_domains' => [
        'site-a.example.com',
        'site-b.example.com',
        '*.example.com' // 와일드카드 도메인
    ]
];
```

### 데이터베이스 구조

각 사이트는 독립적인 데이터베이스를 가집니다:

```php {{ title: '데이터베이스 설정' }}
// config/tenancy.php
return [
    'database' => [
        'based_on' => 'domain',
        'prefix' => 'tenant_',
        'suffix' => '',
    ]
];
```

### 파일 시스템 구조

각 사이트는 독립적인 파일 저장소를 가집니다:

```php {{ title: '파일 시스템 설정' }}
// config/tenancy.php
return [
    'filesystem' => [
        'disk' => 'local',
        'root_override' => [
            'local' => '%storage_path%/app/tenants/%tenant_id%',
            'public' => '%storage_path%/app/public/tenants/%tenant_id%',
        ],
    ]
];
```

### 사이트 생성

새로운 사이트를 생성하는 방법:

```php {{ title: '사이트 생성' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::create([
    'id' => 'site-a',
    'domain' => 'site-a.example.com',
    'database' => [
        'name' => 'tenant_site_a',
    ],
]);

$tenant->run(function () {
    // 사이트 초기화
    Artisan::call('migrate');
    Artisan::call('db:seed');
});
```

### 사이트 설정

사이트별 설정을 관리하는 방법:

```php {{ title: '사이트 설정' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 설정 저장
$tenant->put('site_name', '사이트 A');
$tenant->put('theme', 'default');
$tenant->put('locale', 'ko');

// 설정 조회
$siteName = $tenant->get('site_name');
$theme = $tenant->get('theme');
$locale = $tenant->get('locale');
```

### 사이트 인식

현재 사이트를 인식하고 처리하는 방법:

```php {{ title: '사이트 인식' }}
use Orbit\Tenancy\Tenant;

// 현재 사이트 확인
$tenant = Tenant::current();

// 사이트 컨텍스트 실행
$tenant->run(function () {
    // 현재 사이트의 컨텍스트에서 실행
    $posts = Post::all();
});

// 사이트 스위칭
Tenant::switchTo('site-b', function () {
    // 사이트 B의 컨텍스트에서 실행
    $posts = Post::all();
});
```

### 사이트 미들웨어

사이트를 인식하고 처리하는 미들웨어:

```php {{ title: '사이트 미들웨어' }}
namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Orbit\Tenancy\Tenant;

class InitializeTenancy
{
    public function handle(Request $request, Closure $next)
    {
        $tenant = Tenant::findByDomain($request->getHost());
        
        if (!$tenant) {
            abort(404, '사이트를 찾을 수 없습니다.');
        }

        $tenant->initialize();

        return $next($request);
    }
}
```

<div className="not-prose">
  <Button href="/multi-site/management" variant="text" arrow="right">
    <>사이트 관리 알아보기</>
  </Button>
</div> 