export const metadata = {
  title: '리소스 공유',
  description: 'CMS-Orbit의 리소스 공유 기능에 대해 알아봅니다.',
}

export const sections = [
  { title: '테마 공유', id: 'theme-sharing' },
  { title: '플러그인 공유', id: 'plugin-sharing' },
  { title: '사용자 공유', id: 'user-sharing' },
]

# 리소스 공유

CMS-Orbit에서 테마, 플러그인, 사용자 등 리소스를 여러 사이트 간에 공유하는 방법을 알아봅니다. {{ className: 'lead' }}

## 테마 공유

### 테마 구조

```php {{ title: '테마 구조' }}
// config/tenancy.php
return [
    'themes' => [
        'shared_path' => 'themes/shared',
        'tenant_path' => 'themes/tenants',
    ],
];
```

### 테마 설치

```php {{ title: '테마 설치' }}
use Orbit\Tenancy\Tenant;

// 공유 테마 설치
$theme = Theme::install('default', [
    'name' => '기본 테마',
    'description' => '기본 테마 설명',
    'version' => '1.0.0',
]);

// 테마 활성화
$tenant = Tenant::find('site-a');
$tenant->run(function () use ($theme) {
    Setting::set('theme.active', $theme->id);
});
```

### 테마 사용

```php {{ title: '테마 사용' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 사이트 A의 테마
$tenant->run(function () {
    $theme = Theme::find(Setting::get('theme.active'));
    $view = $theme->view('home');
});

// 사이트 B의 테마
$tenant = Tenant::find('site-b');
$tenant->run(function () {
    $theme = Theme::find(Setting::get('theme.active'));
    $view = $theme->view('home');
});
```

## 플러그인 공유

### 플러그인 구조

```php {{ title: '플러그인 구조' }}
// config/tenancy.php
return [
    'plugins' => [
        'shared_path' => 'plugins/shared',
        'tenant_path' => 'plugins/tenants',
    ],
];
```

### 플러그인 설치

```php {{ title: '플러그인 설치' }}
use Orbit\Tenancy\Tenant;

// 공유 플러그인 설치
$plugin = Plugin::install('contact-form', [
    'name' => '연락처 폼',
    'description' => '연락처 폼 플러그인',
    'version' => '1.0.0',
]);

// 플러그인 활성화
$tenant = Tenant::find('site-a');
$tenant->run(function () use ($plugin) {
    Setting::set('plugins.active', [$plugin->id]);
});
```

### 플러그인 사용

```php {{ title: '플러그인 사용' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 사이트 A의 플러그인
$tenant->run(function () {
    $plugins = Plugin::whereIn('id', Setting::get('plugins.active'))->get();
    foreach ($plugins as $plugin) {
        $plugin->boot();
    }
});

// 사이트 B의 플러그인
$tenant = Tenant::find('site-b');
$tenant->run(function () {
    $plugins = Plugin::whereIn('id', Setting::get('plugins.active'))->get();
    foreach ($plugins as $plugin) {
        $plugin->boot();
    }
});
```

## 사용자 공유

### 사용자 구조

```php {{ title: '사용자 구조' }}
// config/tenancy.php
return [
    'users' => [
        'shared' => true,
        'model' => \App\Models\User::class,
    ],
];
```

### 사용자 생성

```php {{ title: '사용자 생성' }}
use Orbit\Tenancy\Tenant;

// 공유 사용자 생성
$user = User::create([
    'name' => '관리자',
    'email' => 'admin@example.com',
    'password' => Hash::make('password'),
]);

// 사용자 권한 설정
$tenant = Tenant::find('site-a');
$tenant->run(function () use ($user) {
    $user->assignRole('admin');
});

$tenant = Tenant::find('site-b');
$tenant->run(function () use ($user) {
    $user->assignRole('editor');
});
```

### 사용자 인증

```php {{ title: '사용자 인증' }}
use Orbit\Tenancy\Tenant;

// 사용자 로그인
$tenant = Tenant::find('site-a');
$tenant->run(function () {
    if (Auth::attempt(['email' => 'admin@example.com', 'password' => 'password'])) {
        // 로그인 성공
    }
});

// 사용자 권한 확인
$tenant = Tenant::find('site-a');
$tenant->run(function () {
    $user = Auth::user();
    if ($user->hasRole('admin')) {
        // 관리자 권한
    }
});
```

### 사용자 미들웨어

```php {{ title: '사용자 미들웨어' }}
namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Orbit\Tenancy\Tenant;

class InitializeTenancyUser
{
    public function handle(Request $request, Closure $next)
    {
        $tenant = Tenant::current();
        
        if ($tenant && Auth::check()) {
            $user = Auth::user();
            
            // 사용자 권한 확인
            if (!$user->hasPermissionTo('access', $tenant)) {
                abort(403, '이 사이트에 접근할 수 없습니다.');
            }
        }

        return $next($request);
    }
}
```

<div className="not-prose">
  <Button href="/multi-site/migration" variant="text" arrow="right">
    <>사이트 마이그레이션 알아보기</>
  </Button>
</div> 