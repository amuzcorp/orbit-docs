export const metadata = {
  title: '사이트 성능',
  description: 'CMS-Orbit의 사이트 성능 최적화 기능에 대해 알아봅니다.',
}

export const sections = [
  { title: '캐싱', id: 'caching' },
  { title: '데이터베이스 최적화', id: 'database-optimization' },
  { title: '파일 시스템 최적화', id: 'filesystem-optimization' },
]

# 사이트 성능

CMS-Orbit의 성능 최적화 기능을 통해 각 사이트의 응답 시간과 리소스 사용을 최적화할 수 있습니다. {{ className: 'lead' }}

## 캐싱

### 캐시 설정

```php {{ title: '캐시 설정' }}
// config/tenancy.php
return [
    'cache' => [
        'driver' => 'redis',
        'prefix' => 'tenant_',
        'default' => 'file',
        'stores' => [
            'file' => [
                'driver' => 'file',
                'path' => storage_path('framework/cache/tenants'),
            ],
            'redis' => [
                'driver' => 'redis',
                'connection' => 'tenant',
            ],
        ],
    ],
];
```

### 데이터 캐싱

```php {{ title: '데이터 캐싱' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 데이터 캐싱
$data = Cache::remember('key', 3600, function () {
    return DB::table('posts')->get();
});

// 태그 기반 캐싱
$posts = Cache::tags(['posts', 'tenant_' . $tenant->id])
    ->remember('posts', 3600, function () {
        return Post::all();
    });

// 캐시 삭제
Cache::tags(['posts', 'tenant_' . $tenant->id])->flush();
```

### 페이지 캐싱

```php {{ title: '페이지 캐싱' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 페이지 캐싱
Route::get('/posts', function () {
    return Cache::remember('page_posts', 3600, function () {
        return view('posts.index', [
            'posts' => Post::all(),
        ]);
    });
});

// 조건부 캐싱
Route::get('/posts/{id}', function ($id) {
    return Cache::remember('post_' . $id, 3600, function () use ($id) {
        return view('posts.show', [
            'post' => Post::find($id),
        ]);
    })->when(!Auth::check());
});
```

## 데이터베이스 최적화

### 쿼리 최적화

```php {{ title: '쿼리 최적화' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Eager 로딩
$posts = Post::with('comments', 'author')->get();

// 인덱스 사용
$posts = Post::where('status', 'published')
    ->where('created_at', '>', now()->subDays(7))
    ->orderBy('created_at', 'desc')
    ->get();

// 청크 처리
Post::chunk(100, function ($posts) {
    foreach ($posts as $post) {
        // 처리
    }
});
```

### 데이터베이스 설정

```php {{ title: '데이터베이스 설정' }}
// config/tenancy.php
return [
    'database' => [
        'connections' => [
            'tenant' => [
                'driver' => 'mysql',
                'host' => env('DB_HOST', '127.0.0.1'),
                'port' => env('DB_PORT', '3306'),
                'database' => env('DB_DATABASE', 'forge'),
                'username' => env('DB_USERNAME', 'forge'),
                'password' => env('DB_PASSWORD', ''),
                'charset' => 'utf8mb4',
                'collation' => 'utf8mb4_unicode_ci',
                'prefix' => '',
                'strict' => true,
                'engine' => 'InnoDB',
                'options' => [
                    'read_timeout' => 60,
                    'write_timeout' => 60,
                ],
            ],
        ],
    ],
];
```

## 파일 시스템 최적화

### 파일 시스템 설정

```php {{ title: '파일 시스템 설정' }}
// config/tenancy.php
return [
    'filesystem' => [
        'disk' => 's3',
        'root_override' => [
            'local' => '%storage_path%/app/tenants/%tenant_id%',
            'public' => '%storage_path%/app/public/tenants/%tenant_id%',
            's3' => 'tenants/%tenant_id%',
        ],
        'visibility' => 'private',
        'options' => [
            'CacheControl' => 'max-age=31536000',
            'ACL' => 'private',
        ],
    ],
];
```

### 파일 최적화

```php {{ title: '파일 최적화' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 이미지 최적화
$image = Image::make($request->file('image'))
    ->resize(800, 600)
    ->encode('jpg', 75);

// 파일 저장
Storage::disk('tenant')->put(
    'images/' . $filename,
    $image
);

// CDN URL 생성
$url = Storage::disk('tenant')->url('images/' . $filename);
```

### 정적 파일 처리

```php {{ title: '정적 파일 처리' }}
// config/tenancy.php
return [
    'static' => [
        'enabled' => true,
        'path' => 'public/tenants',
        'url' => 'tenants',
        'cache' => [
            'enabled' => true,
            'duration' => 31536000, // 1년
        ],
    ],
];
```

### 성능 모니터링

```php {{ title: '성능 모니터링' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 쿼리 로깅
DB::enableQueryLog();

// 쿼리 실행
$posts = Post::all();

// 쿼리 로그 확인
$queries = DB::getQueryLog();

// 성능 메트릭 수집
$metrics = [
    'memory_usage' => memory_get_usage(),
    'execution_time' => microtime(true) - LARAVEL_START,
    'query_count' => count($queries),
];

// 성능 로그 저장
Log::info('Performance metrics', [
    'tenant_id' => $tenant->id,
    'metrics' => $metrics,
]);
```

### 성능 최적화 명령어

```bash {{ title: '성능 최적화 명령어' }}
# 캐시 클리어
php artisan tenancy:cache-clear

# 뷰 캐시 클리어
php artisan tenancy:view-clear

# 라우트 캐시 클리어
php artisan tenancy:route-clear

# 설정 캐시 클리어
php artisan tenancy:config-clear
```

<div className="not-prose">
  <Button href="/multi-site/monitoring" variant="text" arrow="right">
    <>사이트 모니터링 알아보기</>
  </Button>
</div> 