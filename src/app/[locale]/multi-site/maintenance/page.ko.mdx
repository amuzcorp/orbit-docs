export const metadata = {
  title: '사이트 유지보수',
  description: 'CMS-Orbit의 사이트 유지보수 기능에 대해 알아봅니다.',
}

export const sections = [
  { title: '업데이트 관리', id: 'update-management' },
  { title: '백업 및 복원', id: 'backup-restore' },
  { title: '모니터링 및 로깅', id: 'monitoring-logging' },
]

# 사이트 유지보수

CMS-Orbit의 유지보수 기능을 통해 각 사이트의 안정성과 보안을 유지할 수 있습니다. {{ className: 'lead' }}

## 업데이트 관리

### 시스템 업데이트

```php {{ title: '시스템 업데이트' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 업데이트 확인
$updates = $tenant->checkUpdates();

if ($updates['available']) {
    // 업데이트 실행
    $tenant->runUpdate([
        'type' => 'system',
        'version' => $updates['latest_version'],
        'backup' => true,
    ]);
}
```

### 패키지 업데이트

```php {{ title: '패키지 업데이트' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 패키지 업데이트 확인
$packages = $tenant->checkPackageUpdates();

foreach ($packages as $package) {
    if ($package['update_available']) {
        // 패키지 업데이트
        $tenant->updatePackage($package['name'], $package['latest_version']);
    }
}
```

### 데이터베이스 업데이트

```php {{ title: '데이터베이스 업데이트' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 마이그레이션 실행
$tenant->run(function () {
    Artisan::call('migrate', [
        '--force' => true,
    ]);
});

// 시드 실행
$tenant->run(function () {
    Artisan::call('db:seed', [
        '--force' => true,
    ]);
});
```

## 백업 및 복원

### 자동 백업

```php {{ title: '자동 백업' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 백업 설정
$tenant->settings()->set('backup', [
    'enabled' => true,
    'schedule' => 'daily',
    'retention' => 7,
    'types' => [
        'database',
        'files',
        'settings',
    ],
]);

// 백업 실행
$backup = $tenant->runBackup([
    'database' => true,
    'files' => true,
    'settings' => true,
]);
```

### 백업 복원

```php {{ title: '백업 복원' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 백업 목록 조회
$backups = $tenant->listBackups();

// 특정 백업 복원
$backup = $backups->first();
$tenant->restoreBackup($backup->id);
```

### 백업 검증

```php {{ title: '백업 검증' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 백업 검증
$backup = $tenant->backups()->latest()->first();
$valid = $backup->verify();

if (!$valid) {
    // 백업 재생성
    $tenant->runBackup();
}
```

## 모니터링 및 로깅

### 시스템 모니터링

```php {{ title: '시스템 모니터링' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 시스템 상태 확인
$status = $tenant->checkSystemStatus();

// 리소스 사용량 모니터링
$metrics = $tenant->getResourceMetrics();

// 오류 로그 확인
$errors = $tenant->getErrorLogs();
```

### 로그 관리

```php {{ title: '로그 관리' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 로그 설정
$tenant->settings()->set('logging', [
    'level' => 'debug',
    'channels' => [
        'daily',
        'slack',
    ],
    'retention' => 30,
]);

// 로그 기록
Log::channel('tenant')->info('Tenant activity', [
    'tenant_id' => $tenant->id,
    'action' => 'update',
    'user_id' => Auth::id(),
]);
```

### 알림 설정

```php {{ title: '알림 설정' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 알림 설정
$tenant->settings()->set('notifications', [
    'enabled' => true,
    'channels' => [
        'email',
        'slack',
    ],
    'events' => [
        'error' => true,
        'warning' => true,
        'info' => false,
    ],
]);

// 알림 발송
$tenant->notify(new SystemAlert([
    'type' => 'error',
    'message' => 'System error occurred',
    'context' => [
        'error' => $error,
        'time' => now(),
    ],
]));
```

### 유지보수 모드

```php {{ title: '유지보수 모드' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 유지보수 모드 활성화
$tenant->maintenanceMode()->enable([
    'message' => 'System maintenance in progress',
    'retry_after' => 3600,
]);

// 유지보수 모드 비활성화
$tenant->maintenanceMode()->disable();
```

### 유지보수 명령어

```bash {{ title: '유지보수 명령어' }}
# 시스템 업데이트
php artisan tenancy:update site-a

# 패키지 업데이트
php artisan tenancy:update-packages site-a

# 백업 실행
php artisan tenancy:backup site-a

# 백업 복원
php artisan tenancy:restore site-a backup-id

# 유지보수 모드
php artisan tenancy:maintenance site-a --enable
```

<div className="not-prose">
  <Button href="/multi-site/troubleshooting" variant="text" arrow="right">
    <>사이트 문제 해결 알아보기</>
  </Button>
</div> 