export const metadata = {
  title: '사이트 마이그레이션',
  description: 'CMS-Orbit의 사이트 마이그레이션 기능에 대해 알아봅니다.',
}

export const sections = [
  { title: '데이터 마이그레이션', id: 'data-migration' },
  { title: '파일 마이그레이션', id: 'file-migration' },
  { title: '설정 마이그레이션', id: 'setting-migration' },
]

# 사이트 마이그레이션

CMS-Orbit에서 사이트의 데이터, 파일, 설정을 다른 사이트로 마이그레이션하는 방법을 알아봅니다. {{ className: 'lead' }}

## 데이터 마이그레이션

### 데이터베이스 백업

```php {{ title: '데이터베이스 백업' }}
use Orbit\Tenancy\Tenant;

$sourceTenant = Tenant::find('site-a');

// 데이터베이스 백업
$backup = $sourceTenant->database()->backup();

// 백업 파일 저장
Storage::put('backups/site-a.sql', $backup);
```

### 데이터베이스 복원

```php {{ title: '데이터베이스 복원' }}
use Orbit\Tenancy\Tenant;

$targetTenant = Tenant::find('site-b');

// 백업 파일 복원
$backup = Storage::get('backups/site-a.sql');
$targetTenant->database()->restore($backup);
```

### 데이터 마이그레이션 명령어

```bash {{ title: '데이터 마이그레이션 명령어' }}
php artisan tenancy:migrate site-a site-b
```

이 명령어는 다음 작업을 수행합니다:
- 사이트 A의 데이터베이스 백업
- 사이트 B의 데이터베이스 복원
- 데이터베이스 연결 설정 업데이트

## 파일 마이그레이션

### 파일 백업

```php {{ title: '파일 백업' }}
use Orbit\Tenancy\Tenant;

$sourceTenant = Tenant::find('site-a');

// 파일 시스템 백업
$files = $sourceTenant->filesystem()->allFiles();

foreach ($files as $file) {
    $content = $sourceTenant->filesystem()->get($file);
    Storage::put("backups/site-a/{$file}", $content);
}
```

### 파일 복원

```php {{ title: '파일 복원' }}
use Orbit\Tenancy\Tenant;

$targetTenant = Tenant::find('site-b');

// 백업 파일 복원
$files = Storage::files('backups/site-a');

foreach ($files as $file) {
    $content = Storage::get($file);
    $targetTenant->filesystem()->put(
        str_replace('backups/site-a/', '', $file),
        $content
    );
}
```

### 파일 마이그레이션 명령어

```bash {{ title: '파일 마이그레이션 명령어' }}
php artisan tenancy:files site-a site-b
```

이 명령어는 다음 작업을 수행합니다:
- 사이트 A의 파일 백업
- 사이트 B의 파일 복원
- 파일 시스템 설정 업데이트

## 설정 마이그레이션

### 설정 백업

```php {{ title: '설정 백업' }}
use Orbit\Tenancy\Tenant;

$sourceTenant = Tenant::find('site-a');

// 설정 백업
$settings = $sourceTenant->settings()->all();
Storage::put('backups/site-a/settings.json', json_encode($settings));
```

### 설정 복원

```php {{ title: '설정 복원' }}
use Orbit\Tenancy\Tenant;

$targetTenant = Tenant::find('site-b');

// 백업 설정 복원
$settings = json_decode(Storage::get('backups/site-a/settings.json'), true);
$targetTenant->settings()->set($settings);
```

### 설정 마이그레이션 명령어

```bash {{ title: '설정 마이그레이션 명령어' }}
php artisan tenancy:settings site-a site-b
```

이 명령어는 다음 작업을 수행합니다:
- 사이트 A의 설정 백업
- 사이트 B의 설정 복원
- 설정 데이터베이스 업데이트

### 전체 마이그레이션

```php {{ title: '전체 마이그레이션' }}
use Orbit\Tenancy\Tenant;

$sourceTenant = Tenant::find('site-a');
$targetTenant = Tenant::find('site-b');

// 데이터베이스 마이그레이션
$backup = $sourceTenant->database()->backup();
$targetTenant->database()->restore($backup);

// 파일 마이그레이션
$files = $sourceTenant->filesystem()->allFiles();
foreach ($files as $file) {
    $content = $sourceTenant->filesystem()->get($file);
    $targetTenant->filesystem()->put($file, $content);
}

// 설정 마이그레이션
$settings = $sourceTenant->settings()->all();
$targetTenant->settings()->set($settings);
```

### 마이그레이션 롤백

```php {{ title: '마이그레이션 롤백' }}
use Orbit\Tenancy\Tenant;

$targetTenant = Tenant::find('site-b');

// 데이터베이스 롤백
$targetTenant->database()->restore('backups/site-b-before-migration.sql');

// 파일 롤백
$files = Storage::files('backups/site-b-before-migration');
foreach ($files as $file) {
    $content = Storage::get($file);
    $targetTenant->filesystem()->put(
        str_replace('backups/site-b-before-migration/', '', $file),
        $content
    );
}

// 설정 롤백
$settings = json_decode(Storage::get('backups/site-b-before-migration/settings.json'), true);
$targetTenant->settings()->set($settings);
```

<div className="not-prose">
  <Button href="/multi-site/backup" variant="text" arrow="right">
    <>사이트 백업 알아보기</>
  </Button>
</div> 