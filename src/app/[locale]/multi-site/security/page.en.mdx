# Multi-Site Security

This guide explains security settings and management for multi-site applications.

## Key Security Areas

- **Authentication**: User authentication and session management
- **Permissions**: Access control and permission management
- **Data Security**: Data encryption and protection
- **Network Security**: SSL/TLS and firewall settings

## Security Configuration

### Authentication Settings

```php {{ title: 'Authentication Settings' }}
// config/tenancy.php
return [
    'auth' => [
        'driver' => 'session',
        'providers' => [
            'users' => [
                'driver' => 'eloquent',
                'model' => App\Models\User::class,
            ],
        ],
        'guards' => [
            'web' => [
                'driver' => 'session',
                'provider' => 'users',
            ],
            'api' => [
                'driver' => 'sanctum',
                'provider' => 'users',
            ],
        ],
    ],
];
```

### Permission Settings

```php {{ title: 'Permission Settings' }}
// config/tenancy.php
return [
    'permissions' => [
        'enabled' => true,
        'cache' => true,
        'super_admin' => [
            'role' => 'super-admin',
            'permissions' => ['*'],
        ],
        'roles' => [
            'admin' => [
                'permissions' => [
                    'manage_users',
                    'manage_content',
                    'manage_settings',
                ],
            ],
            'editor' => [
                'permissions' => [
                    'manage_content',
                ],
            ],
        ],
    ],
];
```

### Data Security

```php {{ title: 'Data Security' }}
// config/tenancy.php
return [
    'security' => [
        'encryption' => [
            'enabled' => true,
            'key' => env('APP_KEY'),
            'cipher' => 'AES-256-CBC',
        ],
        'hashing' => [
            'driver' => 'bcrypt',
            'rounds' => 10,
        ],
        'sanitization' => [
            'enabled' => true,
            'strip_tags' => true,
            'escape_html' => true,
        ],
    ],
];
```

### Network Security

```php {{ title: 'Network Security' }}
// config/tenancy.php
return [
    'security' => [
        'ssl' => [
            'enabled' => true,
            'force' => true,
            'hsts' => [
                'enabled' => true,
                'max_age' => 31536000,
                'include_subdomains' => true,
            ],
        ],
        'firewall' => [
            'enabled' => true,
            'rules' => [
                'block_suspicious_ips' => true,
                'rate_limit' => [
                    'enabled' => true,
                    'max_attempts' => 60,
                    'decay_minutes' => 1,
                ],
            ],
        ],
    ],
];
```

## Security Feature Implementation

### User Authentication

```php {{ title: 'User Authentication' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Authenticate user
$authenticated = $tenant->auth()->attempt([
    'email' => $email,
    'password' => $password,
]);

if ($authenticated) {
    // Create session
    $tenant->auth()->login($user);
    
    // Create token
    $token = $tenant->auth()->createToken($user);
}

// Logout
$tenant->auth()->logout();
```

### Permission Check

```php {{ title: 'Permission Check' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Check permission
$hasPermission = $tenant->permissions()->check($user, 'manage_users');

if ($hasPermission) {
    // Perform authorized action
}

// Assign role
$tenant->permissions()->assignRole($user, 'admin');

// Grant permission
$tenant->permissions()->grant($user, 'manage_content');
```

### Data Encryption

```php {{ title: 'Data Encryption' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Encrypt data
$encrypted = $tenant->security()->encrypt($data);

// Decrypt data
$decrypted = $tenant->security()->decrypt($encrypted);

// Create secure hash
$hashed = $tenant->security()->hash($password);
```

### Security Audit

```php {{ title: 'Security Audit' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// Log security event
$tenant->security()->log([
    'event' => 'login_attempt',
    'user_id' => $user->id,
    'ip' => request()->ip(),
    'user_agent' => request()->userAgent(),
]);

// Monitor security events
$events = $tenant->security()->getEvents([
    'type' => 'suspicious',
    'since' => now()->subDay(),
]);
```

## Security Commands

```bash {{ title: 'Security Commands' }}
# Check security settings
php artisan tenancy:security-check site-a

# Regenerate permission cache
php artisan tenancy:permission-cache site-a

# Check security logs
php artisan tenancy:security-logs site-a

# Renew SSL certificate
php artisan tenancy:ssl-renew site-a
```

## Best Practices

1. Apply regular security updates
2. Implement strong password policies
3. Follow the principle of least privilege
4. Perform regular security audits
5. Monitor security events

<div className="not-prose">
  <Button href="/multi-site/troubleshooting" variant="text" arrow="right">
    <>Learn about Troubleshooting</>
  </Button>
</div> 