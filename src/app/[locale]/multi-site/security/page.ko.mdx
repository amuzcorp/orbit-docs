export const metadata = {
  title: '사이트 보안',
  description: 'CMS-Orbit의 사이트 보안 기능에 대해 알아봅니다.',
}

export const sections = [
  { title: '인증 및 권한', id: 'authentication-authorization' },
  { title: '데이터 보안', id: 'data-security' },
  { title: '네트워크 보안', id: 'network-security' },
]

# 사이트 보안

CMS-Orbit의 사이트 보안 기능을 통해 각 사이트의 데이터와 리소스를 안전하게 보호할 수 있습니다. {{ className: 'lead' }}

## 인증 및 권한

### 사용자 인증

```php {{ title: '사용자 인증' }}
// config/auth.php
return [
    'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],
        'tenant' => [
            'driver' => 'session',
            'provider' => 'tenants',
        ],
    ],
    'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => App\Models\User::class,
        ],
        'tenants' => [
            'driver' => 'eloquent',
            'model' => App\Models\Tenant::class,
        ],
    ],
];
```

### 권한 관리

```php {{ title: '권한 관리' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 역할 생성
$role = Role::create([
    'name' => 'admin',
    'guard_name' => 'tenant',
]);

// 권한 생성
$permission = Permission::create([
    'name' => 'manage-users',
    'guard_name' => 'tenant',
]);

// 역할에 권한 할당
$role->givePermissionTo($permission);

// 사용자에게 역할 할당
$user->assignRole($role);
```

### 접근 제어

```php {{ title: '접근 제어' }}
namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Orbit\Tenancy\Tenant;

class TenantAccess
{
    public function handle(Request $request, Closure $next)
    {
        $tenant = Tenant::current();
        
        if (!$tenant) {
            abort(404, '사이트를 찾을 수 없습니다.');
        }

        if (!Auth::check()) {
            return redirect()->route('tenant.login');
        }

        if (!Auth::user()->hasPermissionTo('access', $tenant)) {
            abort(403, '이 사이트에 접근할 수 없습니다.');
        }

        return $next($request);
    }
}
```

## 데이터 보안

### 데이터 암호화

```php {{ title: '데이터 암호화' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 민감한 데이터 암호화
$encrypted = encrypt([
    'api_key' => 'secret-key',
    'database_password' => 'password',
]);

// 암호화된 데이터 저장
$tenant->settings()->set('encrypted_data', $encrypted);

// 데이터 복호화
$decrypted = decrypt($tenant->settings()->get('encrypted_data'));
```

### 데이터 마스킹

```php {{ title: '데이터 마스킹' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 민감한 데이터 마스킹
$masked = mask([
    'email' => 'user@example.com',
    'phone' => '010-1234-5678',
], ['email', 'phone']);

// 마스킹된 데이터 저장
$tenant->settings()->set('masked_data', $masked);
```

### 데이터 검증

```php {{ title: '데이터 검증' }}
use Orbit\Tenancy\Tenant;

$tenant = Tenant::find('site-a');

// 데이터 검증 규칙
$rules = [
    'name' => 'required|string|max:255',
    'email' => 'required|email|unique:users',
    'password' => 'required|min:8',
];

// 데이터 검증
$validator = Validator::make($request->all(), $rules);

if ($validator->fails()) {
    return response()->json([
        'errors' => $validator->errors(),
    ], 422);
}
```

## 네트워크 보안

### SSL/TLS 설정

```php {{ title: 'SSL/TLS 설정' }}
// config/tenancy.php
return [
    'ssl' => [
        'enabled' => true,
        'force' => true,
        'certificate' => [
            'path' => 'ssl/certificate.pem',
            'key' => 'ssl/private.key',
        ],
    ],
];
```

### 방화벽 설정

```php {{ title: '방화벽 설정' }}
// config/tenancy.php
return [
    'firewall' => [
        'enabled' => true,
        'rules' => [
            'allow' => [
                '127.0.0.1',
                '192.168.1.0/24',
            ],
            'deny' => [
                '10.0.0.0/8',
            ],
        ],
    ],
];
```

### 요청 제한

```php {{ title: '요청 제한' }}
// config/tenancy.php
return [
    'rate_limit' => [
        'enabled' => true,
        'max_attempts' => 60,
        'decay_minutes' => 1,
        'by' => 'ip',
    ],
];
```

### 보안 헤더

```php {{ title: '보안 헤더' }}
namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;

class SecurityHeaders
{
    public function handle(Request $request, Closure $next)
    {
        $response = $next($request);

        $response->headers->set('X-Frame-Options', 'SAMEORIGIN');
        $response->headers->set('X-XSS-Protection', '1; mode=block');
        $response->headers->set('X-Content-Type-Options', 'nosniff');
        $response->headers->set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
        $response->headers->set('Content-Security-Policy', "default-src 'self'");

        return $response;
    }
}
```

### 보안 이벤트

```php {{ title: '보안 이벤트' }}
use Orbit\Tenancy\Events\SecurityEvent;

// 보안 이벤트 발생
event(new SecurityEvent([
    'type' => 'login_failed',
    'user_id' => $user->id,
    'ip' => $request->ip(),
    'user_agent' => $request->userAgent(),
]));

// 보안 이벤트 리스너
Event::listen(SecurityEvent::class, function ($event) {
    Log::warning('Security event', [
        'type' => $event->type,
        'user_id' => $event->user_id,
        'ip' => $event->ip,
        'user_agent' => $event->user_agent,
    ]);
});
```

<div className="not-prose">
  <Button href="/multi-site/performance" variant="text" arrow="right">
    <>사이트 성능 알아보기</>
  </Button>
</div> 